{% raw %}
import 'package:flutter/material.dart';
{% if 'intl' in options.imports or 'DateFormat' in handlers_code %}
import 'package:intl/intl.dart';
{% endif %}

{# ===============================
   „Ç™„Éó„Ç∑„Éß„É≥„ÅÆÊó¢ÂÆöÂÄ§ÔºàJinja ÂÅ¥Ôºâ
   =============================== #}
{% set is_stateful      = options.is_stateful      | default(false) %}
{% set use_scrollview   = options.use_scrollview   | default(true)  %}
{% set use_safearea     = options.use_safearea     | default(false) %}
{% set add_appbar       = options.add_appbar       | default(true)  %}
{% set appbar_title     = options.appbar_title     | default(class_name) %}
{% set use_scaffold     = options.use_scaffold     | default(true)  %}
{% set keyboard_dismiss = options.keyboard_dismiss | default(true)  %}
{% set page_padding     = options.page_padding     | default(16.0)   %}
{% set stretch          = options.stretch          | default(true)  %}

class {{ class_name }} extends {% if is_stateful %}StatefulWidget{% else %}StatelessWidget{% endif %} {
  const {{ class_name }}({super.key});

  {% if is_stateful %}
  @override
  State<{{ class_name }}> createState() => _{{ class_name }}State();
}

class _{{ class_name }}State extends State<{{ class_name }}> {
  {# ---- ControllerÈÉ®ÂàÜ„ÇíËá™ÂãïÁîüÊàêÔºàÂøÖË¶ÅÊï∞„Å†„ÅëÔºâ ---- #}
  {% for c in controllers %}
  final TextEditingController {{ c }} = TextEditingController();
  {% endfor %}
  
  {# ---- RadioGroupÁî®„ÅÆÁä∂ÊÖãÂ§âÊï∞ÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶ËøΩÂä†Ôºâ ---- #}
  String _selectedMood = "üòä";

  {% if controllers %}
  @override
  void dispose() {
    {% for c in controllers %}
    {{ c }}.dispose();
    {% endfor %}
    super.dispose();
  }
  {% endif %}

  @override
  Widget build(BuildContext context) {
    Widget content = {{ widget_tree }};

    {# ---- ‰ΩôÁôΩÔºàÁîªÈù¢Â§ñÂÅ¥Ôºâ ---- #}
    {% if page_padding > 0.0 %}
    content = Padding(
      padding: const EdgeInsets.all({{ page_padding }}),
      child: content,
    );
    {% endif %}

    {# ---- ScrollView „É©„ÉÉ„ÉóÔºàÂøÖË¶ÅÊôÇ„ÅÆ„Åø„ÄÅStack„ÅÆÂ†¥Âêà„ÅØÂ§ñ„Å´ÈÖçÁΩÆÔºâ ---- #}
    {% if use_scrollview %}
    {% if options.has_stack_background or options.has_expanded %}
    {# Stack„Åæ„Åü„ÅØExpanded„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅSingleChildScrollView„ÅÆÂ§ñ„Å´ÈÖçÁΩÆ ---- #}
    {# Expanded„ÅØRow/Column„ÅÆÁõ¥Êé•„ÅÆÂ≠ê„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅSingleChildScrollView„Åß„É©„ÉÉ„Éó„Åß„Åç„Å™„ÅÑ ---- #}
    {% else %}
    content = SingleChildScrollView(
      child: content,
    );
    {% endif %}
    {% endif %}

    {# ---- „Ç≠„Éº„Éú„Éº„Éâ„ÅßÈö†„Çå„Å´„Åè„Åè„Åô„ÇãÔºãÂ§ñ„Çø„ÉÉ„Éó„ÅßDismiss ---- #}
    {% if keyboard_dismiss %}
    content = GestureDetector(
      behavior: HitTestBehavior.translucent,
      onTap: () => FocusScope.of(context).unfocus(),
      child: content,
    );
    {% endif %}

    {# ---- Scaffold „ÅßÂåÖ„ÇÄ ---- #}
    {% if use_scaffold %}
    {% if options.scaffold_bg_decoration %}
    {# XML drawable„ÅÆËÉåÊôØ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØContainer„ÅßBoxDecoration„Çí‰ΩøÁî® #}
    content = Container(
      decoration: {{ options.scaffold_bg_decoration }},
      child: content,
    );
    {% elif options.scaffold_bg_image %}
    {# ËÉåÊôØÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØStackÊßãÈÄ†„Çí‰ΩøÁî®ÔºàËÉåÊôØ„ÇíËÉåÈù¢„Å´„ÄÅUI„ÇíÂâçÊôØ„Å´Ôºâ #}
    content = Stack(
      children: [
        Positioned.fill(
          child: Image.asset(
            '{{ options.scaffold_bg_image }}',
            fit: BoxFit.cover,
            errorBuilder: (context, error, stackTrace) => Container(
              color: Colors.grey[300],
              child: Icon(Icons.image, size: 80, color: Colors.grey[600]),
            ),
          ),
        ),
        content,
      ],
    );
    {% endif %}
    return Scaffold(
      {% if add_appbar %}appBar: AppBar(title: Text('{{ appbar_title }}')), {% endif %}
      {% if options.scaffold_bg_color %}
      backgroundColor: const Color({{ options.scaffold_bg_color }}),
      {% endif %}
      body: SafeArea(
        child: Padding(
        {# „ÇΩ„Éï„Éà„Ç≠„Éº„Éú„Éº„ÉâÂàÜ„ÅÆ‰∏ã‰ΩôÁôΩ„ÄÇ„Çπ„ÇØ„É≠„Éº„É´ÁÑ°„ÅóÁîªÈù¢„Åß„ÇÇË¢´„Çä„Å´„Åè„ÅÑ #}
        padding: EdgeInsets.only(bottom: MediaQuery.of(context).viewInsets.bottom),
        child: content,
        ),
      ),
    );
    {% else %}
    return content;
    {% endif %}
  }

  {% if handlers_code %}
  {{ handlers_code }}
  {% endif %}
}
  {% else %} {# ------------ Stateless Áâà ------------ #}
  @override
  Widget build(BuildContext context) {
    Widget content = {{ widget_tree }};

    {% if page_padding > 0.0 %}
    content = Padding(
      padding: const EdgeInsets.all({{ page_padding }}),
      child: content,
    );
    {% endif %}

    {% if use_scrollview %}
    {% if options.has_stack_background or options.has_expanded %}
    {# Stack„Åæ„Åü„ÅØExpanded„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅSingleChildScrollView„ÅÆÂ§ñ„Å´ÈÖçÁΩÆ ---- #}
    {# Expanded„ÅØRow/Column„ÅÆÁõ¥Êé•„ÅÆÂ≠ê„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅSingleChildScrollView„Åß„É©„ÉÉ„Éó„Åß„Åç„Å™„ÅÑ ---- #}
    {% else %}
    content = SingleChildScrollView(
      child: content,
    );
    {% endif %}
    {% endif %}

    {% if keyboard_dismiss %}
    content = GestureDetector(
      behavior: HitTestBehavior.translucent,
      onTap: () => FocusScope.of(context).unfocus(),
      child: content,
    );
    {% endif %}

    {% if use_scaffold %}
    {% if options.scaffold_bg_decoration %}
    {# XML drawable„ÅÆËÉåÊôØ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØContainer„ÅßBoxDecoration„Çí‰ΩøÁî® #}
    content = Container(
      decoration: {{ options.scaffold_bg_decoration }},
      child: content,
    );
    {% elif options.scaffold_bg_image %}
    {# ËÉåÊôØÁîªÂÉè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØStackÊßãÈÄ†„Çí‰ΩøÁî®ÔºàËÉåÊôØ„ÇíËÉåÈù¢„Å´„ÄÅUI„ÇíÂâçÊôØ„Å´Ôºâ #}
    content = Stack(
      children: [
        Positioned.fill(
          child: Image.asset(
            '{{ options.scaffold_bg_image }}',
            fit: BoxFit.cover,
            errorBuilder: (context, error, stackTrace) => Container(
              color: Colors.grey[300],
              child: Icon(Icons.image, size: 80, color: Colors.grey[600]),
            ),
          ),
        ),
        content,
      ],
    );
    {% endif %}
    return Scaffold(
      {% if add_appbar %}
      appBar: AppBar(
        title: Text('{{ appbar_title }}'),
        {% if options.appbar_bg_color %}
        backgroundColor: const Color({{ options.appbar_bg_color }}),
        {% endif %}
      ),
      {% endif %}
      {% if options.scaffold_bg_color %}
      backgroundColor: const Color({{ options.scaffold_bg_color }}),
      {% endif %}
      body: SafeArea(
        child: Padding(
        padding: EdgeInsets.only(bottom: MediaQuery.of(context).viewInsets.bottom),
        child: content,
        ),
      ),
    );
    {% else %}
    return content;
    {% endif %}
  }

  {% if handlers_code %}
  {{ handlers_code }}
  {% endif %}
}
{% endif %}
{% endraw %}
